# 🆕 功能更新说明

## ✨ 新增功能

### 1. 📧 邮箱验证码注册
- **三步骤注册流程**：邮箱验证 → 验证码确认 → 完善信息
- **6位数验证码**：10分钟有效期，最多5次尝试
- **防暴力破解**：失败次数限制和倒计时重发
- **邮箱域名限制**：只允许指定后缀的校内邮箱

### 2. 📸 照片上传功能
- **个人照片**：用于身份确认
- **一卡通照片**：验证学生身份
- **文件限制**：支持 JPG、PNG 格式，最大 5MB

### 3. 📎 附件上传功能
- **项目经验佐证**：支持上传相关证明材料
- **多格式支持**：PDF、Word 文档、图片
- **文件管理**：自动分类存储

### 4. 🎓 年级特定信息收集

#### 大一学生信息
- **高中学校**：毕业高中名称
- **高考分数**：用于学习能力评估
- **编程基础**：是否有编程经验
- **经历描述**：详细的编程学习背景

#### 大二学生信息
- **大一绩点**：学习成绩评估
- **转专业情况**：是否转专业及专业变更信息
- **C语言成绩**：编程基础课程表现
- **C++成绩**：进阶编程课程表现

### 5. ⚙️ 管理员配置系统
- **纳新开关**：可控制大一、大二纳新开关
- **时间管理**：设置申请开始和截止时间
- **申请限制**：配置每人最大申请数量
- **实时生效**：配置修改立即生效

## 🔧 技术实现

### 后端新增

#### 数据模型扩展
```typescript
// Application 模型新增字段
personalPhoto?: string;           // 个人照片路径
studentCardPhoto?: string;        // 一卡通照片路径
experienceAttachment?: string;    // 经验佐证附件
gradeSpecificInfo?: {            // 年级特定信息
  highSchoolInfo?: { ... };      // 大一学生信息
  sophomoreInfo?: { ... };       // 大二学生信息
};
```

#### 新增模型
```typescript
// SystemConfig 模型
key: string;                     // 配置键
value: string;                   // 配置值
description?: string;            // 配置描述
```

#### 文件上传中间件
- **Multer 配置**：支持多文件上传
- **文件分类存储**：按类型自动分类
- **安全检查**：文件类型和大小限制

#### 配置服务
- **ConfigService**：统一配置管理
- **Redis 缓存**：提高配置读取性能
- **默认配置**：自动初始化系统配置

### 前端新增

#### 新的申请表单
- **动态字段**：根据年级显示不同信息收集
- **文件上传**：拖拽上传和预览功能
- **实时验证**：表单字段实时校验
- **进度指示**：多步骤填写进度展示

#### 管理员配置页面
- **可视化配置**：开关、时间选择器
- **实时预览**：配置状态实时显示
- **批量保存**：一键保存所有配置

## 📊 新的 API 接口

### 认证相关
```
POST /api/auth/send-verification-code    # 发送验证码
POST /api/auth/verify-email-code         # 验证验证码
```

### 申请相关
```
GET  /api/applications/config            # 获取申请配置
POST /api/applications                   # 创建申请（支持文件上传）
```

### 管理员配置
```
GET  /admin/configs                      # 获取所有配置
PUT  /admin/configs/:key                 # 更新单个配置
PUT  /admin/configs                      # 批量更新配置
GET  /admin/recruitment-status           # 获取纳新状态
```

## 🎯 使用流程

### 学生申请流程
1. **邮箱验证**：输入校内邮箱 → 接收验证码 → 验证成功
2. **注册账号**：填写姓名和密码 → 完成注册
3. **提交申请**：
   - 填写基本信息
   - 上传个人照片和一卡通照片
   - 根据年级填写特定信息
   - 填写自我介绍和项目经验
   - 上传经验佐证材料
   - 提交申请

### 管理员管理流程
1. **配置系统**：设置纳新开关、时间限制
2. **审核申请**：查看详细信息和上传文件
3. **安排面试**：分配时间和地点
4. **记录结果**：填写面试评分和反馈

## 🔒 安全特性

### 文件上传安全
- **类型限制**：只允许指定格式文件
- **大小限制**：单文件最大 5MB
- **路径安全**：防止路径遍历攻击
- **病毒扫描**：可扩展病毒检测

### 数据验证
- **后端验证**：所有数据二次验证
- **前端验证**：实时用户体验优化
- **类型安全**：TypeScript 类型检查

## 📱 部署更新

### 更新代码
```bash
# 拉取最新代码并部署
./deploy.sh update
```

### 首次部署
```bash
# 首次部署新功能
./deploy.sh install
```

### 配置邮箱
确保 `.env` 文件中配置了邮箱服务器：
```bash
EMAIL_HOST=smtp.your-domain.com
EMAIL_USER=noreply@your-domain.com
EMAIL_PASS=your_email_password
ALLOWED_EMAIL_DOMAIN=@stu.your-university.edu.cn
```

## 🎉 功能亮点

- ✅ **邮箱验证码注册** - 更安全的注册方式
- ✅ **详细信息收集** - 根据年级个性化收集
- ✅ **文件上传支持** - 照片和附件上传
- ✅ **管理员配置** - 灵活的系统配置
- ✅ **实时生效** - 配置修改立即生效
- ✅ **用户体验优化** - 现代化的交互设计

---

**立即体验新功能：**
```bash
./deploy.sh update && ./test-email-verification.sh
```